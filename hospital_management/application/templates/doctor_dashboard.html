<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Doctor's Dashboard</title>
    <style>
        /* Styles adapted for clean layout */
        body { font-family: Arial, sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; padding: 2rem; min-height: 100vh; }
        .dashboard-container { width: 100%; max-width: 900px; background-color: #ffffff; border: 1px solid #ccc; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); padding-bottom: 1.5rem; }
        .header-bar { display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; border-bottom: 1px solid #ccc; }
        .welcome-user { font-weight: bold; }
        .user-nav a { text-decoration: none; color: #dc3545; margin-left: 10px; }
        .content-card { margin: 1.5rem; border: 1px solid #ccc; border-radius: 8px; }
        .card-header { padding: 0.8rem 1rem; border-bottom: 1px solid #ccc; font-size: 1.3rem; font-weight: bold; }
        
        /* Table Styles */
        .appointments-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .appointments-table th, .appointments-table td { border: 1px solid #eee; padding: 10px; text-align: left; font-size: 0.9rem; }
        .appointments-table th { background-color: #f8f9fa; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 1rem; border-bottom: 1px solid #f0f0f0; }
        
        /* Button Styles */
        .btn-update { background-color: #cce5ff; border: 1px solid #007bff; color: #007bff; padding: 5px 10px; text-decoration: none; border-radius: 4px; }
        .btn-complete { background-color: #d4edda; border: 1px solid #28a745; color: #28a745; padding: 5px 10px; border-radius: 4px; }
        .btn-cancel { background-color: #f8d7da; border: 1px solid #dc3545; color: #dc3545; padding: 5px 10px; border-radius: 4px; }
        .btn-view { background-color: #e0e0e0; border: 1px solid #ccc; color: #333; text-decoration: none; padding: 5px 10px; border-radius: 4px; }
        .btn-provide { background-color: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 4px; float: right; margin-top: 10px; text-decoration: none; }
        .actions { display: flex; gap: 5px; }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header class="header-bar">
            <span class="welcome-user">Welcome Dr. {{ doctor.full_name }}</span>
            <a href="{{ url_for('auth.logout') }}" style="color:#dc3545;">logout</a>
        </header>

        <section class="content-card">
            <div class="card-header">Upcoming Appointments</div>
            <div style="overflow-x:auto;">
                <table class="appointments-table">
                    <thead>
                        <tr>
                            <th>Sr No.</th>
                            <th>Patient Name</th>
                            <th>Patient History</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for appt in appointments %}
                        <tr>
                            <td>{{ appt.id }}.</td>
                            <td>Mr. {{ appt.patient.full_name if appt.patient.full_name else appt.patient.username }}</td>
                            <td>
                                <a href="{{ url_for('doctor.update_history', appointment_id=appt.id) }}" class="btn-update">update</a>
                            </td>
                            <td class="actions">
                                {% if appt.status == 'Booked' %}
                                <form action="{{ url_for('doctor.appointment_action', id=appt.id, action='complete') }}" method="POST" style="display:inline;">
                                    <button class="btn-complete">mark as complete</button>
                                </form>
                                <form action="{{ url_for('doctor.appointment_action', id=appt.id, action='cancel') }}" method="POST" style="display:inline;">
                                    <button class="btn-cancel">cancel</button>
                                </form>
                                {% else %}
                                    <span style="font-weight:bold;">{{ appt.status }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                        {% if not appointments %}
                            <tr><td colspan="4" style="text-align:center;">No upcoming appointments.</td></tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </section>

        <section class="content-card">
            <div class="card-header">Assigned Patients</div>
            <div class="item-list">
                {% for patient in assigned_patients %}
                <div class="list-item">
                    <span>Mr. {{ patient.full_name if patient.full_name else patient.username }}</span>
                    <a href="{{ url_for('doctor.view_patient_history', patient_id=patient.id) }}" class="btn-view">view</a>
                </div>
                {% endfor %}
                {% if not assigned_patients %}
                    <p style="padding:1rem;">No assigned patients.</p>
                {% endif %}
            </div>
            
            <a href="{{ url_for('doctor.availability') }}" class="btn-provide">Provide Availibility</a>
        </section>
    </div>
</body>
</html>